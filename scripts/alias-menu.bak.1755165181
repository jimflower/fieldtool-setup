#!/usr/bin/env bash
[ -f /opt/fieldtool/config.env ] && . /opt/fieldtool/config.env || true
set -euo pipefail
IF="${1:-eth0}"

echo "=== Temp aliases on $IF ==="
# List only labelled IPv4 addrs (eth0:*), so we show :cam and :bench
mapfile -t ENTRIES < <(ip -o -4 addr show dev "$IF" label "$IF:*" | awk '{print $4" "$NF}')
if (( ${#ENTRIES[@]} == 0 )); then
  echo "[INFO] None. Tip: add with: fieldtool run ip-alias add auto:192.168.8.0/24 eth0"
  exit 0
fi

for i in "${!ENTRIES[@]}"; do
  printf "%d) %s\n" $((i+1)) "${ENTRIES[$i]}"
done

read -rp "Select number to delete (or Enter to exit): " sel
[[ -z "${sel:-}" ]] && exit 0
idx=$((sel-1))
[[ $idx -lt 0 || $idx -ge ${#ENTRIES[@]} ]] && { echo "[ERR] invalid selection"; exit 2; }

cidr=$(awk '{print $1}' <<<"${ENTRIES[$idx]}")
label=$(awk '{print $2}' <<<"${ENTRIES[$idx]}")
sudo ip addr del "$cidr" dev "$IF" label "$label"
echo "[OK] Removed $cidr ($label)"
